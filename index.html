<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة أنماط التعلم الذكية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800;900&family=Amiri:wght@400;700&display=swap');
        
        :root {
            --primary-blue: #1e40af;
            --primary-green: #059669;
            --primary-purple: #7c3aed;
            --primary-orange: #ea580c;
            --accent-yellow: #fbbf24;
            --text-dark: #1f2937;
            --text-medium: #374151;
            --text-light: #6b7280;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --border-light: #e5e7eb;
            --shadow-soft: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-medium: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-large: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            --gradient-warning: linear-gradient(135deg, #fc466b 0%, #3f5efb 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            background-size: 400% 400%;
            animation: gradientFlow 20s ease infinite;
            min-height: 100vh;
            color: var(--text-dark);
            overflow-x: hidden;
        }

        @keyframes gradientFlow {
            0% { background-position: 0% 50%; }
            25% { background-position: 100% 50%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
            100% { background-position: 0% 50%; }
        }

        /* Enhanced Glass Morphism */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: var(--shadow-large);
            position: relative;
            overflow: hidden;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        /* Floating Elements Animation */
        .floating-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .shape {
            position: absolute;
            opacity: 0.1;
            animation: floatShape 15s ease-in-out infinite;
        }

        .shape-1 {
            top: 10%;
            left: 10%;
            width: 80px;
            height: 80px;
            background: var(--primary-blue);
            border-radius: 50%;
            animation-delay: 0s;
        }

        .shape-2 {
            top: 20%;
            right: 15%;
            width: 60px;
            height: 60px;
            background: var(--primary-green);
            border-radius: 20px;
            animation-delay: 2s;
        }

        .shape-3 {
            bottom: 30%;
            left: 20%;
            width: 100px;
            height: 100px;
            background: var(--primary-purple);
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            animation-delay: 4s;
        }

        .shape-4 {
            bottom: 20%;
            right: 10%;
            width: 70px;
            height: 70px;
            background: var(--primary-orange);
            border-radius: 50% 10px 50% 10px;
            animation-delay: 1s;
        }

        @keyframes floatShape {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-20px) rotate(90deg); }
            50% { transform: translateY(-40px) rotate(180deg); }
            75% { transform: translateY(-20px) rotate(270deg); }
        }

        /* Enhanced Learning Cards */
        .learning-card {
            background: var(--bg-white);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--shadow-medium);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
        }

        .learning-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            animation: rotate 8s linear infinite;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .learning-card:hover::before {
            opacity: 1;
        }

        .learning-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: var(--shadow-large);
            border-color: rgba(102, 126, 234, 0.3);
        }

        @keyframes rotate {
            100% { transform: rotate(360deg); }
        }

        /* Interactive Buttons */
        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 16px;
            padding: 1rem 2rem;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-medium);
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s ease;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: var(--shadow-large);
        }

        /* Quiz Interface */
        .quiz-option {
            background: var(--bg-white);
            border: 2px solid var(--border-light);
            border-radius: 16px;
            padding: 1.5rem;
            margin: 1rem 0;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .quiz-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: left 0.3s ease;
        }

        .quiz-option:hover::before {
            left: 100%;
        }

        .quiz-option:hover {
            transform: translateX(8px);
            border-color: var(--primary-blue);
            box-shadow: var(--shadow-medium);
        }

        .quiz-option.selected {
            border-color: var(--primary-green);
            background: rgba(5, 150, 105, 0.05);
            box-shadow: 0 0 0 4px rgba(5, 150, 105, 0.1);
        }

        /* Progress Bar */
        .progress-container {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50px;
            height: 16px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-bar {
            height: 100%;
            background: var(--gradient-success);
            border-radius: 50px;
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: progressShimmer 2s infinite;
        }

        @keyframes progressShimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Navigation */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: var(--shadow-soft);
        }

        /* Results Display */
        .result-card {
            background: var(--bg-white);
            border-radius: 24px;
            padding: 3rem;
            text-align: center;
            box-shadow: var(--shadow-large);
            position: relative;
            overflow: hidden;
            border: 3px solid transparent;
        }

        .result-card.visual {
            border-color: var(--primary-blue);
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.05) 0%, rgba(255, 255, 255, 1) 100%);
        }

        .result-card.auditory {
            border-color: var(--primary-green);
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.05) 0%, rgba(255, 255, 255, 1) 100%);
        }

        .result-card.kinesthetic {
            border-color: var(--primary-purple);
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.05) 0%, rgba(255, 255, 255, 1) 100%);
        }

        .result-icon {
            font-size: 6rem;
            animation: bounce 2s infinite;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            60% { transform: translateY(-10px); }
        }

        /* Score Visualization */
        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .score-circle::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: rotate 3s linear infinite;
        }

        .score-visual { background: var(--gradient-primary); }
        .score-auditory { background: var(--gradient-success); }
        .score-kinesthetic { background: var(--gradient-warning); }

        /* Modal Enhancements */
        .modal {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(25px);
            border-radius: 24px;
            box-shadow: var(--shadow-large);
            animation: modalSlide 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Input Fields */
        .input-field {
            background: var(--bg-white);
            border: 2px solid var(--border-light);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            transition: all 0.3s ease;
            color: var(--text-dark);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 4px rgba(30, 64, 175, 0.1);
            transform: translateY(-1px);
        }

        /* Typography */
        .title-main {
            font-family: 'Amiri', serif;
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--text-dark);
            text-align: center;
            margin-bottom: 1rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .title-section {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 1.5rem;
        }

        .text-body {
            font-size: 1.1rem;
            line-height: 1.7;
            color: var(--text-medium);
        }

        /* Dashboard Cards */
        .dashboard-card {
            background: var(--bg-white);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--shadow-medium);
            transition: all 0.3s ease;
            border: 1px solid var(--border-light);
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-large);
        }

        /* Statistics Cards */
        .stat-card {
            background: var(--bg-white);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: var(--shadow-soft);
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .stat-card.visual { border-left-color: var(--primary-blue); }
        .stat-card.auditory { border-left-color: var(--primary-green); }
        .stat-card.kinesthetic { border-left-color: var(--primary-purple); }
        .stat-card.total { border-left-color: var(--primary-orange); }

        .stat-card:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-medium);
        }

        /* Learning Plan Cards */
        .plan-card {
            background: var(--bg-white);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-soft);
            border-left: 4px solid var(--accent-yellow);
            transition: all 0.3s ease;
        }

        .plan-card:hover {
            transform: translateX(8px);
            box-shadow: var(--shadow-medium);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .title-main { font-size: 2.5rem; }
            .title-section { font-size: 2rem; }
            .learning-card { padding: 1.5rem; }
            .result-card { padding: 2rem; }
            .btn-primary { padding: 0.8rem 1.5rem; }
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gradient-primary);
            border-radius: 10px;
            border: 2px solid transparent;
            background-clip: content-box;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gradient-success);
            background-clip: content-box;
        }

        /* Loading Animation */
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(102, 126, 234, 0.1);
            border-left: 4px solid var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Enhanced Hover Effects */
        .hover-lift {
            transition: all 0.3s ease;
        }

        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-large);
        }

        /* Icon Animations */
        .icon-bounce {
            animation: iconBounce 2s ease-in-out infinite;
        }

        @keyframes iconBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Gradient Text */
        .gradient-text {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Success Animation */
        .success-checkmark {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--primary-green);
            position: relative;
            animation: successPulse 0.6s ease-in-out;
        }

        .success-checkmark::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }

        @keyframes successPulse {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <!-- Floating Shapes Background -->
    <div class="floating-shapes">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
        <div class="shape shape-3"></div>
        <div class="shape shape-4"></div>
    </div>

    <!-- Navigation -->
    <nav class="navbar relative z-20">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4 space-x-reverse">
                    <div class="text-5xl icon-bounce">🎓</div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">منصة أنماط التعلم الذكية</h1>
                        <p class="text-sm text-gray-600">اكتشف طريقتك المثلى في التعلم</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4 space-x-reverse">
                    <div id="userInfo" class="hidden glass-card px-4 py-2">
                        <span id="currentUser" class="text-gray-800 font-medium"></span>
                    </div>
                    <button id="themeToggle" class="p-3 rounded-full glass-card hover-lift">
                        <span class="text-2xl">🌙</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container mx-auto px-6 py-8 relative z-10">
        <!-- Welcome Section -->
        <div id="welcomeSection" class="text-center mb-12">
            <div class="glass-card p-12 mb-8">
                <h2 class="title-main gradient-text mb-6">مرحباً بك في رحلة اكتشاف نمط تعلمك! 🚀</h2>
                <p class="text-body mb-12 max-w-4xl mx-auto">
                    اكتشف كيف تتعلم بشكل أفضل واحصل على خطة تعليمية مخصصة لك. 
                    منصتنا تستخدم أحدث الأساليب العلمية لتحديد نمط التعلم المناسب لك وتقدم توصيات مخصصة للمعلمين.
                </p>
                
                <div class="grid md:grid-cols-3 gap-8 mb-12">
                    <div class="learning-card hover-lift">
                        <div class="result-icon text-6xl mb-4 text-blue-600">👁️</div>
                        <h3 class="text-2xl font-bold mb-4 text-gray-800">المتعلم البصري</h3>
                        <p class="text-body mb-4">يتعلم من خلال الصور والمخططات والعروض المرئية والألوان</p>
                        <div class="flex justify-center space-x-2 space-x-reverse">
                            <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">مخططات</span>
                            <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">صور</span>
                            <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">ألوان</span>
                        </div>
                    </div>
                    
                    <div class="learning-card hover-lift">
                        <div class="result-icon text-6xl mb-4 text-green-600">👂</div>
                        <h3 class="text-2xl font-bold mb-4 text-gray-800">المتعلم السمعي</h3>
                        <p class="text-body mb-4">يتعلم من خلال الاستماع والمناقشة والأصوات والموسيقى</p>
                        <div class="flex justify-center space-x-2 space-x-reverse">
                            <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">مناقشات</span>
                            <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">استماع</span>
                            <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">موسيقى</span>
                        </div>
                    </div>
                    
                    <div class="learning-card hover-lift">
                        <div class="result-icon text-6xl mb-4 text-purple-600">✋</div>
                        <h3 class="text-2xl font-bold mb-4 text-gray-800">المتعلم الحركي</h3>
                        <p class="text-body mb-4">يتعلم من خلال التطبيق العملي والحركة واللمس</p>
                        <div class="flex justify-center space-x-2 space-x-reverse">
                            <span class="px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm">تجارب</span>
                            <span class="px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm">حركة</span>
                            <span class="px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm">تطبيق</span>
                        </div>
                    </div>
                </div>
                
                <button class="btn-primary text-xl py-6 px-12 font-bold" onclick="startAssessment()">
                    ابدأ اكتشاف نمط تعلمك الآن! ✨
                </button>
            </div>
        </div>

        <!-- Assessment Section -->
        <div id="assessmentSection" class="hidden">
            <div class="glass-card p-10 mb-8">
                <!-- Progress Bar -->
                <div class="mb-10">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-lg font-semibold text-gray-800">تقدم الاختبار</span>
                        <span class="glass-card px-4 py-2 text-lg font-semibold text-gray-800">
                            <span id="currentQuestion">0</span> من <span id="totalQuestions">0</span>
                        </span>
                    </div>
                    <div class="progress-container">
                        <div id="progressBar" class="progress-bar" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Student Info Form -->
                <div id="studentInfoForm" class="mb-8">
                    <h3 class="title-section text-center mb-8">📝 معلوماتك الشخصية</h3>
                    <div class="grid md:grid-cols-3 gap-8">
                        <div>
                            <label class="block text-gray-800 font-semibold mb-3 text-lg">الاسم الكامل *</label>
                            <input type="text" id="studentName" class="input-field w-full" placeholder="أدخل اسمك الكامل">
                        </div>
                        <div>
                            <label class="block text-gray-800 font-semibold mb-3 text-lg">العمر *</label>
                            <input type="number" id="studentAge" min="5" max="100" class="input-field w-full" placeholder="العمر">
                        </div>
                        <div>
                            <label class="block text-gray-800 font-semibold mb-3 text-lg">الصف الدراسي *</label>
                            <select id="studentGrade" class="input-field w-full">
                                <option value="">اختر الصف</option>
                                <option value="الأول الابتدائي">الأول الابتدائي</option>
                                <option value="الثاني الابتدائي">الثاني الابتدائي</option>
                                <option value="الثالث الابتدائي">الثالث الابتدائي</option>
                                <option value="الرابع الابتدائي">الرابع الابتدائي</option>
                                <option value="الخامس الابتدائي">الخامس الابتدائي</option>
                                <option value="السادس الابتدائي">السادس الابتدائي</option>
                                <option value="الأول المتوسط">الأول المتوسط</option>
                                <option value="الثاني المتوسط">الثاني المتوسط</option>
                                <option value="الثالث المتوسط">الثالث المتوسط</option>
                                <option value="الأول الثانوي">الأول الثانوي</option>
                                <option value="الثاني الثانوي">الثاني الثانوي</option>
                                <option value="الثالث الثانوي">الثالث الثانوي</option>
                            </select>
                        </div>
                    </div>
                    <div class="text-center mt-8">
                        <button class="btn-primary text-lg py-4 px-10" onclick="startQuiz()">
                            متابعة للاختبار 📋
                        </button>
                    </div>
                </div>

                <!-- Quiz Section -->
                <div id="quizSection" class="hidden">
                    <div class="text-center mb-10">
                        <h3 class="title-section">🧠 اختبار نمط التعلم</h3>
                        <p class="text-body">اختر الإجابة التي تناسبك أكثر</p>
                    </div>
                    
                    <div id="questionContainer" class="mb-10">
                        <!-- Questions will be generated here -->
                    </div>

                    <div class="flex justify-between items-center">
                        <button id="prevBtn" class="btn-primary bg-gray-500 py-4 px-8" onclick="previousQuestion()" disabled>
                            ← السابق
                        </button>
                        <div class="flex space-x-4 space-x-reverse">
                            <button id="nextBtn" class="btn-primary py-4 px-8" onclick="nextQuestion()">
                                التالي →
                            </button>
                            <button id="submitBtn" class="hidden btn-primary py-4 px-8" onclick="calculateResults()">
                                احسب النتيجة 🎯
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden">
            <div class="glass-card p-10 mb-8">
                <div class="text-center mb-10">
                    <h2 class="title-section">🎉 نتائج اختبار نمط التعلم</h2>
                </div>

                <!-- Main Result Card -->
                <div id="mainResultCard" class="result-card mb-10">
                    <div class="result-icon mb-6" id="resultIcon"></div>
                    <h3 class="text-4xl font-bold mb-4 text-gray-800" id="resultTitle"></h3>
                    <p class="text-body mb-6 max-w-2xl mx-auto" id="resultDescription"></p>
                    <div class="text-6xl font-bold text-gray-800 mb-4" id="resultPercentage"></div>
                    <div class="text-lg text-gray-600">هذا هو نمط التعلم الأقوى لديك</div>
                </div>

                <!-- Detailed Results -->
                <div class="grid md:grid-cols-3 gap-8 mb-10">
                    <div class="dashboard-card text-center">
                        <div class="score-circle score-visual mx-auto mb-4">
                            <span id="visualScore">0%</span>
                        </div>
                        <h4 class="font-bold text-xl mb-2 text-gray-800">👁️ بصري</h4>
                        <p class="text-gray-600">التعلم من خلال الرؤية</p>
                    </div>
                    
                    <div class="dashboard-card text-center">
                        <div class="score-circle score-auditory mx-auto mb-4">
                            <span id="auditoryScore">0%</span>
                        </div>
                        <h4 class="font-bold text-xl mb-2 text-gray-800">👂 سمعي</h4>
                        <p class="text-gray-600">التعلم من خلال الاستماع</p>
                    </div>
                    
                    <div class="dashboard-card text-center">
                        <div class="score-circle score-kinesthetic mx-auto mb-4">
                            <span id="kinestheticScore">0%</span>
                        </div>
                        <h4 class="font-bold text-xl mb-2 text-gray-800">✋ حركي</h4>
                        <p class="text-gray-600">التعلم من خلال التطبيق</p>
                    </div>
                </div>

                <!-- Personalized Learning Plan -->
                <div class="glass-card p-8 mb-8">
                    <h4 class="text-2xl font-bold text-gray-800 mb-6 text-center">📚 خطة التعلم المخصصة لك</h4>
                    <div id="learningPlan" class="space-y-4"></div>
                </div>

                <!-- Tips and Recommendations -->
                <div class="glass-card p-8 mb-10">
                    <h4 class="text-2xl font-bold text-gray-800 mb-6 text-center">💡 نصائح مخصصة لك</h4>
                    <div id="personalizedTips" class="grid md:grid-cols-2 gap-6"></div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-wrap gap-6 justify-center">
                    <button class="btn-primary py-4 px-8 text-lg hover-lift" onclick="downloadReport()">
                        📄 تحميل التقرير
                    </button>
                    <button class="btn-primary py-4 px-8 text-lg hover-lift" onclick="shareResults()">
                        📤 مشاركة النتائج
                    </button>
                    <button class="btn-primary py-4 px-8 text-lg hover-lift" onclick="retakeTest()">
                        🔄 إعادة الاختبار
                    </button>
                </div>
            </div>
        </div>

        <!-- Teacher Access -->
        <div class="text-center mb-8">
            <button id="teacherAccessBtn" class="btn-primary py-6 px-12 text-xl font-bold hover-lift" onclick="showTeacherAccess()">
                👨‍🏫 دخول المعلم
            </button>
        </div>

        <!-- Teacher Setup Modal -->
        <div id="teacherSetupModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="modal p-10 max-w-lg w-full mx-4">
                <div class="text-center mb-8">
                    <div class="success-checkmark mx-auto mb-4"></div>
                    <h3 class="title-section text-gray-800">إعداد حساب المعلم</h3>
                    <p class="text-body">مرحباً! قم بإنشاء حسابك الخاص للوصول لأدوات المعلم المتقدمة</p>
                </div>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-gray-800 font-semibold mb-3">اسم المعلم *</label>
                        <input type="text" id="teacherName" class="input-field w-full" placeholder="أدخل اسمك الكامل">
                    </div>
                    
                    <div>
                        <label class="block text-gray-800 font-semibold mb-3">المدرسة/المؤسسة</label>
                        <input type="text" id="teacherSchool" class="input-field w-full" placeholder="اسم المدرسة أو المؤسسة (اختياري)">
                    </div>
                    
                    <div>
                        <label class="block text-gray-800 font-semibold mb-3">إنشاء كلمة المرور *</label>
                        <div class="relative">
                            <input type="password" id="newTeacherPassword" class="input-field w-full" placeholder="أدخل كلمة مرور قوية" oninput="checkPasswordStrength()">
                            <button type="button" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700" onclick="togglePasswordVisibility('newTeacherPassword')">
                                👁️
                            </button>
                        </div>
                        <div class="mt-2">
                            <div class="flex justify-between text-xs text-gray-600 mb-1">
                                <span>قوة كلمة المرور</span>
                                <span id="strengthText">ضعيف</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div id="strengthBar" class="bg-red-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-gray-800 font-semibold mb-3">تأكيد كلمة المرور *</label>
                        <input type="password" id="confirmTeacherPassword" class="input-field w-full" placeholder="أعد إدخال كلمة المرور">
                    </div>
                </div>
                
                <div class="flex gap-4 mt-8">
                    <button class="btn-primary flex-1 py-3" onclick="setupTeacherAccount()">
                        إنشاء الحساب 🚀
                    </button>
                    <button class="btn-primary bg-gray-500 flex-1 py-3" onclick="hideTeacherSetup()">
                        إلغاء
                    </button>
                </div>
                <div id="setupError" class="text-red-500 text-sm mt-3 text-center hidden"></div>
            </div>
        </div>

        <!-- Teacher Login Modal -->
        <div id="teacherLoginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="modal p-8 max-w-md w-full mx-4">
                <div class="text-center mb-6">
                    <div class="text-6xl mb-4">🔐</div>
                    <h3 class="text-2xl font-bold text-gray-800">دخول المعلم</h3>
                    <p class="text-body mt-2" id="welcomeTeacherText">أدخل كلمة المرور للوصول للوحة التحكم</p>
                </div>
                <div class="relative mb-4">
                    <input type="password" id="teacherPassword" class="input-field w-full" placeholder="كلمة المرور">
                    <button type="button" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700" onclick="togglePasswordVisibility('teacherPassword')">
                        👁️
                    </button>
                </div>
                <div class="flex gap-4">
                    <button class="btn-primary flex-1 py-3" onclick="verifyTeacher()">دخول</button>
                    <button class="btn-primary bg-gray-500 flex-1 py-3" onclick="hideTeacherLogin()">إلغاء</button>
                </div>
                <div class="text-center mt-4">
                    <button class="text-sm text-blue-600 hover:text-blue-800 underline" onclick="showPasswordReset()">
                        نسيت كلمة المرور؟
                    </button>
                </div>
                <div id="loginError" class="text-red-500 text-sm mt-3 text-center hidden">كلمة المرور غير صحيحة</div>
            </div>
        </div>

        <!-- Teacher Dashboard -->
        <div id="teacherDashboard" class="hidden">
            <div class="glass-card p-10">
                <!-- Dashboard Header -->
                <div class="flex justify-between items-center mb-10">
                    <div>
                        <h2 class="title-section text-gray-800">👨‍🏫 لوحة تحكم المعلم</h2>
                        <p class="text-body" id="teacherWelcome">مرحباً بك في لوحة التحكم المتقدمة</p>
                    </div>
                    <div class="flex gap-4">
                        <button class="btn-primary py-3 px-6 hover-lift" onclick="logout()">
                            تسجيل خروج 🚪
                        </button>
                    </div>
                </div>

                <!-- Statistics Cards -->
                <div class="grid md:grid-cols-4 gap-6 mb-10">
                    <div class="stat-card total hover-lift">
                        <div class="text-4xl font-bold text-orange-600" id="totalStudents">0</div>
                        <div class="text-lg text-gray-600 mt-2">إجمالي الطلاب</div>
                        <div class="text-3xl mt-3">👥</div>
                    </div>
                    <div class="stat-card visual hover-lift">
                        <div class="text-4xl font-bold text-blue-600" id="visualLearners">0</div>
                        <div class="text-lg text-gray-600 mt-2">متعلم بصري</div>
                        <div class="text-3xl mt-3">👁️</div>
                    </div>
                    <div class="stat-card auditory hover-lift">
                        <div class="text-4xl font-bold text-green-600" id="auditoryLearners">0</div>
                        <div class="text-lg text-gray-600 mt-2">متعلم سمعي</div>
                        <div class="text-3xl mt-3">👂</div>
                    </div>
                    <div class="stat-card kinesthetic hover-lift">
                        <div class="text-4xl font-bold text-purple-600" id="kinestheticLearners">0</div>
                        <div class="text-lg text-gray-600 mt-2">متعلم حركي</div>
                        <div class="text-3xl mt-3">✋</div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="grid md:grid-cols-2 gap-8 mb-8">
                    <div class="dashboard-card">
                        <h3 class="text-lg font-bold text-gray-800 mb-4 text-center">توزيع أنماط التعلم</h3>
                        <canvas id="learningStyleChart" width="400" height="400"></canvas>
                    </div>
                    <div class="dashboard-card">
                        <h3 class="text-lg font-bold text-gray-800 mb-4 text-center">توزيع الطلاب حسب الصف</h3>
                        <canvas id="gradeDistributionChart" width="400" height="400"></canvas>
                    </div>
                </div>

                <!-- Learning Plans Generator -->
                <div class="dashboard-card mb-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">🎯 مولد الخطط التعليمية الذكي</h3>
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="text-center">
                            <button class="btn-primary w-full py-4 hover-lift" onclick="generateVisualPlan()">
                                👁️ خطة للمتعلمين البصريين
                            </button>
                        </div>
                        <div class="text-center">
                            <button class="btn-primary w-full py-4 hover-lift" onclick="generateAuditoryPlan()">
                                👂 خطة للمتعلمين السمعيين
                            </button>
                        </div>
                        <div class="text-center">
                            <button class="btn-primary w-full py-4 hover-lift" onclick="generateKinestheticPlan()">
                                ✋ خطة للمتعلمين الحركيين
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Export Tools -->
                <div class="dashboard-card mb-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">🛠️ أدوات التصدير والإدارة</h3>
                    <div class="grid md:grid-cols-4 gap-4">
                        <button class="btn-primary py-3 px-4 text-sm hover-lift" onclick="exportStudentData()">
                            📊 تصدير بيانات الطلاب
                        </button>
                        <button class="btn-primary py-3 px-4 text-sm hover-lift" onclick="exportLessonPlans()">
                            📚 تصدير الخطط الدرسية
                        </button>
                        <button class="btn-primary py-3 px-4 text-sm hover-lift" onclick="exportDetailedReport()">
                            📈 تقرير مفصل
                        </button>
                        <button class="btn-primary bg-red-600 py-3 px-4 text-sm hover-lift" onclick="clearAllData()">
                            🗑️ مسح جميع البيانات
                        </button>
                    </div>
                </div>

                <!-- Students List -->
                <div class="dashboard-card">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800">📋 قائمة الطلاب التفصيلية</h3>
                        <div class="flex gap-2">
                            <select id="filterGrade" class="input-field text-sm" onchange="filterStudents()">
                                <option value="">جميع الصفوف</option>
                            </select>
                            <select id="filterStyle" class="input-field text-sm" onchange="filterStudents()">
                                <option value="">جميع الأنماط</option>
                                <option value="visual">بصري</option>
                                <option value="auditory">سمعي</option>
                                <option value="kinesthetic">حركي</option>
                            </select>
                        </div>
                    </div>
                    <div id="studentsList" class="space-y-4 max-h-96 overflow-y-auto">
                        <p class="text-gray-500 text-center py-8">لا توجد بيانات طلاب حتى الآن</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Generated Learning Plan Modal -->
        <div id="learningPlanModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="modal p-8 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <div class="text-center mb-6">
                    <h3 class="title-section text-gray-800" id="planModalTitle">خطة تعليمية مخصصة</h3>
                    <button class="absolute top-4 left-4 text-gray-500 hover:text-gray-700 text-2xl" onclick="hideLearningPlanModal()">×</button>
                </div>
                <div id="planModalContent" class="space-y-6">
                    <!-- Plan content will be generated here -->
                </div>
                <div class="text-center mt-8">
                    <button class="btn-primary py-3 px-8 hover-lift" onclick="downloadCurrentPlan()">
                        📄 تحميل الخطة
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration and Data
        let currentQuestionIndex = 0;
        let studentAnswers = [];
        let studentData = JSON.parse(localStorage.getItem('studentData')) || [];
        let teacherData = JSON.parse(localStorage.getItem('teacherData')) || null;
        let isTeacherLoggedIn = false;
        let currentGeneratedPlan = '';

        // Enhanced Learning Style Questions
        const questions = [
            {
                question: "عندما أحاول تذكر رقم هاتف جديد، أميل إلى:",
                options: [
                    { text: "كتابته وتصور شكل الأرقام في ذهني", type: "visual", weight: 4 },
                    { text: "تكراره بصوت عالٍ عدة مرات", type: "auditory", weight: 4 },
                    { text: "الضغط على الأرقام بأصابعي أثناء حفظه", type: "kinesthetic", weight: 4 }
                ]
            },
            {
                question: "عندما أضيع في مكان جديد، أفضل أن:",
                options: [
                    { text: "أنظر إلى خريطة أو لافتات الطرق", type: "visual", weight: 4 },
                    { text: "أسأل شخصاً عن الاتجاهات شفهياً", type: "auditory", weight: 4 },
                    { text: "أستكشف المنطقة بنفسي حتى أجد الطريق", type: "kinesthetic", weight: 4 }
                ]
            },
            {
                question: "أثناء محاضرة مهمة، أركز أكثر عندما:",
                options: [
                    { text: "أرى عروضاً تقديمية ومخططات على الشاشة", type: "visual", weight: 3 },
                    { text: "أستمع بعناية لصوت المحاضر ونبرته", type: "auditory", weight: 3 },
                    { text: "أدون ملاحظات بيدي أو أحرك قلماً", type: "kinesthetic", weight: 3 }
                ]
            },
            {
                question: "عند تعلم مهارة جديدة مثل الطبخ، أفضل:",
                options: [
                    { text: "مشاهدة فيديو تعليمي أو صور خطوة بخطوة", type: "visual", weight: 4 },
                    { text: "الاستماع لشخص يشرح لي الطريقة", type: "auditory", weight: 4 },
                    { text: "التجريب المباشر والتعلم من الأخطاء", type: "kinesthetic", weight: 4 }
                ]
            },
            {
                question: "عندما أحتاج لتذكر قائمة مشتريات، أميل إلى:",
                options: [
                    { text: "كتابتها في قائمة مرتبة بألوان مختلفة", type: "visual", weight: 3 },
                    { text: "تكرارها في ذهني كأغنية أو إيقاع", type: "auditory", weight: 3 },
                    { text: "تخيل نفسي أتجول في المتجر وأجمع الأشياء", type: "kinesthetic", weight: 3 }
                ]
            },
            {
                question: "في اجتماع أو نقاش جماعي، أشارك أكثر عندما:",
                options: [
                    { text: "أرى مخططات أو عروض بصرية تدعم النقاش", type: "visual", weight: 3 },
                    { text: "أستمع لآراء الآخرين وأبني عليها شفهياً", type: "auditory", weight: 3 },
                    { text: "أستطيع الوقوف والحركة أثناء التفكير", type: "kinesthetic", weight: 3 }
                ]
            },
            {
                question: "عند محاولة فهم جهاز إلكتروني جديد، أبدأ بـ:",
                options: [
                    { text: "قراءة دليل الاستخدام والنظر للرسوم التوضيحية", type: "visual", weight: 4 },
                    { text: "سؤال شخص خبير ليشرح لي كيفية استخدامه", type: "auditory", weight: 4 },
                    { text: "الضغط على الأزرار وتجريب الوظائف مباشرة", type: "kinesthetic", weight: 4 }
                ]
            },
            {
                question: "عندما أشعر بالتوتر أو القلق، أهدأ أكثر عندما:",
                options: [
                    { text: "أنظر إلى مناظر طبيعية أو صور مريحة", type: "visual", weight: 2 },
                    { text: "أستمع لموسيقى هادئة أو أصوات الطبيعة", type: "auditory", weight: 2 },
                    { text: "أمارس الرياضة أو أتحرك في المكان", type: "kinesthetic", weight: 2 }
                ]
            },
            {
                question: "عند حل مسألة رياضية معقدة، أفضل أن:",
                options: [
                    { text: "أرسم مخططات ومعادلات بصرية واضحة", type: "visual", weight: 4 },
                    { text: "أشرح خطوات الحل بصوت عالٍ لنفسي", type: "auditory", weight: 4 },
                    { text: "أستخدم أشياء ملموسة أو أعد على أصابعي", type: "kinesthetic", weight: 4 }
                ]
            },
            {
                question: "في المطعم، أختار طعامي عادة بناءً على:",
                options: [
                    { text: "شكل الطبق في الصور أو المنيو المصور", type: "visual", weight: 2 },
                    { text: "وصف النادل أو توصيات الآخرين", type: "auditory", weight: 2 },
                    { text: "رائحة الطعام أو تجربة سابقة لمذاقه", type: "kinesthetic", weight: 2 }
                ]
            },
            {
                question: "عندما أحاول تذكر حدث مهم، أتذكر أكثر:",
                options: [
                    { text: "كيف بدا المكان والأشخاص والألوان", type: "visual", weight: 3 },
                    { text: "ما قيل من كلمات والأصوات المحيطة", type: "auditory", weight: 3 },
                    { text: "كيف شعرت جسدياً وما لمسته أو فعلته", type: "kinesthetic", weight: 3 }
                ]
            },
            {
                question: "عند تجميع أثاث جديد، أعتمد بشكل أساسي على:",
                options: [
                    { text: "الرسوم التوضيحية والمخططات المرفقة", type: "visual", weight: 4 },
                    { text: "قراءة التعليمات المكتوبة بصوت عالٍ", type: "auditory", weight: 4 },
                    { text: "تجريب القطع ومحاولة تركيبها عملياً", type: "kinesthetic", weight: 4 }
                ]
            },
            {
                question: "في بيئة العمل أو الدراسة، أكون أكثر إنتاجية عندما:",
                options: [
                    { text: "يكون مكتبي منظماً بصرياً مع ملاحظات ملونة", type: "visual", weight: 3 },
                    { text: "أستطيع التحدث مع الزملاء ومناقشة الأفكار", type: "auditory", weight: 3 },
                    { text: "أستطيع الحركة والتنقل أثناء التفكير", type: "kinesthetic", weight: 3 }
                ]
            },
            {
                question: "عند تعلم رقصة أو حركة رياضية جديدة، أتعلم أسرع عندما:",
                options: [
                    { text: "أشاهد المدرب يؤدي الحركة عدة مرات", type: "visual", weight: 4 },
                    { text: "أستمع لتعليمات صوتية مفصلة عن كل خطوة", type: "auditory", weight: 4 },
                    { text: "أجرب الحركة بنفسي مع التوجيه المباشر", type: "kinesthetic", weight: 4 }
                ]
            },
            {
                question: "عندما أقرأ قصة أو رواية، أستمتع أكثر عندما:",
                options: [
                    { text: "أتخيل المشاهد والشخصيات بصرياً في ذهني", type: "visual", weight: 3 },
                    { text: "أقرأ بصوت عالٍ أو أستمع للكتاب الصوتي", type: "auditory", weight: 3 },
                    { text: "أشعر بالمشاعر والأحاسيس التي تصفها القصة", type: "kinesthetic", weight: 3 }
                ]
            }
        ];

        // Enhanced Learning Styles Data
        const learningStyles = {
            visual: {
                name: "المتعلم البصري",
                icon: "👁️",
                description: "تتعلم بشكل أفضل من خلال الرؤية والصور والمخططات البصرية والألوان",
                characteristics: [
                    "يفضل المعلومات المرئية والمخططات",
                    "يتذكر الوجوه أكثر من الأسماء",
                    "يحب التنظيم والترتيب البصري",
                    "يفكر بالصور والألوان",
                    "يستفيد من الخرائط الذهنية"
                ],
                tips: [
                    "استخدم الألوان المختلفة في الملاحظات والتنظيم",
                    "ارسم مخططات ذهنية ومخططات بيانية للمواضيع",
                    "استخدم البطاقات التعليمية المصورة والملونة",
                    "شاهد الفيديوهات التعليمية والعروض المرئية",
                    "نظم مساحة الدراسة بصرياً واستخدم الملصقات"
                ],
                studyMethods: [
                    "الخرائط الذهنية والمخططات البيانية",
                    "استخدام الألوان في التمييز والتصنيف",
                    "الرسوم التوضيحية والصور والمخططات",
                    "الجداول والقوائم المنظمة بصرياً",
                    "العروض التقديمية والفيديوهات التعليمية"
                ],
                teachingStrategies: [
                    "استخدام السبورة الذكية والعروض التقديمية",
                    "تقديم المعلومات بصرياً من خلال المخططات والرسوم",
                    "استخدام الألوان لتمييز المفاهيم المختلفة",
                    "توفير مواد بصرية متنوعة (صور، فيديوهات، مخططات)",
                    "تشجيع الطلاب على رسم وتصور المفاهيم"
                ],
                activities: [
                    "إنشاء خرائط ذهنية للمواضيع الدراسية",
                    "استخدام الألوان في تنظيم الملاحظات",
                    "مشاهدة الأفلام التعليمية والوثائقيات",
                    "رسم المخططات والجداول التوضيحية",
                    "استخدام البطاقات التعليمية المصورة"
                ],
                assessment: "التقييم من خلال الرسوم والمخططات والعروض المرئية والمشاريع الفنية والخرائط الذهنية"
            },
            auditory: {
                name: "المتعلم السمعي",
                icon: "👂",
                description: "تتعلم بشكل أفضل من خلال الاستماع والمناقشة والأصوات والموسيقى",
                characteristics: [
                    "يتعلم من خلال الاستماع والمناقشة",
                    "يتذكر ما يسمعه بوضوح",
                    "يحب الموسيقى والأصوات والإيقاعات",
                    "يفضل التعلم الجماعي والمناقشات",
                    "يستفيد من التكرار الصوتي"
                ],
                tips: [
                    "استمع للمحاضرات والتسجيلات الصوتية والبودكاست",
                    "شارك في المناقشات الجماعية والحوارات التعليمية",
                    "اقرأ المواد بصوت عالٍ أو استمع للكتب الصوتية",
                    "استخدم الموسيقى والإيقاع في حفظ المعلومات",
                    "سجل ملاحظاتك الصوتية واستمع إليها لاحقاً"
                ],
                studyMethods: [
                    "التسجيلات الصوتية والبودكاست التعليمي",
                    "المناقشات الجماعية والحوارات",
                    "القراءة بصوت عالٍ والتكرار الشفهي",
                    "استخدام الموسيقى والإيقاع كخلفية تعليمية",
                    "الشرح الشفهي للآخرين"
                ],
                teachingStrategies: [
                    "تقديم المحاضرات الشفهية التفاعلية",
                    "تشجيع المناقشات الجماعية والعصف الذهني",
                    "استخدام التسجيلات الصوتية والموسيقى التعليمية",
                    "تنظيم جلسات حوار ونقاش حول المواضيع",
                    "تشجيع الطلاب على الشرح الشفهي"
                ],
                activities: [
                    "المناقشات الجماعية والحوارات التعليمية",
                    "العصف الذهني الشفوي والعروض التقديمية",
                    "التعلم من خلال الأغاني والإيقاع والقوافي",
                    "العروض الشفوية والخطابة والإلقاء",
                    "الألعاب الصوتية واللغوية والتفاعلية"
                ],
                assessment: "التقييم الشفوي والعروض التقديمية الصوتية والمناقشات والامتحانات الشفهية"
            },
            kinesthetic: {
                name: "المتعلم الحركي",
                icon: "✋",
                description: "تتعلم بشكل أفضل من خلال الحركة والتطبيق العملي واللمس والتجريب",
                characteristics: [
                    "يتعلم من خلال التطبيق العملي والتجريب",
                    "يحتاج للحركة والنشاط أثناء التعلم",
                    "يفضل التجارب والأنشطة اليدوية والعملية",
                    "يتذكر من خلال العمل والممارسة الفعلية",
                    "يستفيد من التعلم التفاعلي والألعاب"
                ],
                tips: [
                    "مارس الأنشطة العملية والتجارب المختبرية",
                    "استخدم يديك في التعلم والكتابة والرسم",
                    "خذ فترات راحة للحركة والنشاط البدني",
                    "تعلم من خلال اللعب والأنشطة التفاعلية",
                    "طبق ما تتعلمه فوراً في مواقف حقيقية"
                ],
                studyMethods: [
                    "التجارب العملية والمختبرات والورش",
                    "الأنشطة اليدوية والحرفية والفنية",
                    "الألعاب التعليمية التفاعلية والمحاكاة",
                    "الرحلات الاستطلاعية الميدانية والزيارات",
                    "التعلم من خلال الحركة والنشاط البدني"
                ],
                teachingStrategies: [
                    "تنظيم التجارب العملية والأنشطة المختبرية",
                    "استخدام الألعاب التعليمية والمحاكاة",
                    "تشجيع التعلم من خلال الحركة والنشاط",
                    "توفير مواد ملموسة وأدوات تفاعلية",
                    "تنظيم الرحلات التعليمية والزيارات الميدانية"
                ],
                activities: [
                    "التجارب العملية والمختبرية والاستكشافية",
                    "الألعاب التعليمية الحركية والتفاعلية",
                    "الأنشطة اليدوية والحرفية والفنية",
                    "التعلم في الهواء الطلق والبيئة الطبيعية",
                    "المحاكاة والتمثيل والأداء العملي"
                ],
                assessment: "التقييم من خلال المشاريع العملية والأداء والعروض التطبيقية والتجارب المختبرية"
            }
        };

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            
            // Add event listeners for buttons
            const startButton = document.querySelector('button[onclick="startAssessment()"]');
            if (startButton) {
                startButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    startAssessment();
                });
            }
        });

        function initializeApp() {
            setupThemeToggle();
            showWelcomeSection();
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', handleKeyboardShortcuts);
        }

        function handleKeyboardShortcuts(e) {
            if (e.key === 'Escape') {
                hideAllModals();
            }
        }

        function hideAllModals() {
            document.getElementById('teacherSetupModal').classList.add('hidden');
            document.getElementById('teacherLoginModal').classList.add('hidden');
            document.getElementById('learningPlanModal').classList.add('hidden');
        }

        function setupThemeToggle() {
            const themeToggle = document.getElementById('themeToggle');
            themeToggle.addEventListener('click', toggleTheme);
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            const themeToggle = document.getElementById('themeToggle');
            themeToggle.innerHTML = document.body.classList.contains('dark-theme') ? '<span class="text-2xl">☀️</span>' : '<span class="text-2xl">🌙</span>';
        }

        function showWelcomeSection() {
            document.getElementById('welcomeSection').classList.remove('hidden');
            document.getElementById('assessmentSection').classList.add('hidden');
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('teacherDashboard').classList.add('hidden');
        }

        function startAssessment() {
            console.log('Starting assessment...');
            
            // Hide welcome section
            const welcomeSection = document.getElementById('welcomeSection');
            if (welcomeSection) {
                welcomeSection.classList.add('hidden');
            }
            
            // Show assessment section
            const assessmentSection = document.getElementById('assessmentSection');
            if (assessmentSection) {
                assessmentSection.classList.remove('hidden');
            }
            
            // Set total questions
            const totalQuestionsElement = document.getElementById('totalQuestions');
            if (totalQuestionsElement) {
                totalQuestionsElement.textContent = questions.length;
            }
            
            // Reset quiz
            resetQuiz();
            
            // Scroll to assessment section
            if (assessmentSection) {
                assessmentSection.scrollIntoView({ behavior: 'smooth' });
            }
        }

        function resetQuiz() {
            currentQuestionIndex = 0;
            studentAnswers = [];
            document.getElementById('studentInfoForm').classList.remove('hidden');
            document.getElementById('quizSection').classList.add('hidden');
            updateProgress();
        }

        function startQuiz() {
            const name = document.getElementById('studentName').value.trim();
            const age = document.getElementById('studentAge').value;
            const grade = document.getElementById('studentGrade').value;

            if (!name || !age || !grade) {
                alert('يرجى إكمال جميع المعلومات المطلوبة');
                return;
            }

            if (age < 5 || age > 100) {
                alert('يرجى إدخال عمر صحيح');
                return;
            }

            document.getElementById('studentInfoForm').classList.add('hidden');
            document.getElementById('quizSection').classList.remove('hidden');
            displayQuestion();
        }

        function displayQuestion() {
            const question = questions[currentQuestionIndex];
            const container = document.getElementById('questionContainer');
            
            container.innerHTML = `
                <div class="glass-card p-8">
                    <h4 class="text-2xl font-bold text-gray-800 mb-8 text-center">
                        السؤال ${currentQuestionIndex + 1}: ${question.question}
                    </h4>
                    <div class="space-y-4">
                        ${question.options.map((option, index) => `
                            <label class="quiz-option flex items-center cursor-pointer">
                                <input type="radio" name="currentQuestion" value="${index}" class="ml-4 w-6 h-6 text-blue-600">
                                <span class="text-gray-800 text-lg">${option.text}</span>
                            </label>
                        `).join('')}
                    </div>
                </div>
            `;

            const options = container.querySelectorAll('input[type="radio"]');
            options.forEach(option => {
                option.addEventListener('change', function() {
                    container.querySelectorAll('.quiz-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.closest('.quiz-option').classList.add('selected');
                });
            });

            updateProgress();
            updateNavigationButtons();
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');

            prevBtn.disabled = currentQuestionIndex === 0;
            prevBtn.classList.toggle('opacity-50', currentQuestionIndex === 0);

            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                saveCurrentAnswer();
                currentQuestionIndex--;
                displayQuestion();
                restoreAnswer();
            }
        }

        function nextQuestion() {
            const selected = document.querySelector('input[name="currentQuestion"]:checked');
            if (!selected) {
                alert('يرجى اختيار إجابة قبل المتابعة');
                return;
            }

            saveCurrentAnswer();
            currentQuestionIndex++;
            
            if (currentQuestionIndex < questions.length) {
                displayQuestion();
                restoreAnswer();
            }
        }

        function saveCurrentAnswer() {
            const selected = document.querySelector('input[name="currentQuestion"]:checked');
            if (selected) {
                studentAnswers[currentQuestionIndex] = parseInt(selected.value);
            }
        }

        function restoreAnswer() {
            if (studentAnswers[currentQuestionIndex] !== undefined) {
                const radio = document.querySelector(`input[name="currentQuestion"][value="${studentAnswers[currentQuestionIndex]}"]`);
                if (radio) {
                    radio.checked = true;
                    radio.closest('.quiz-option').classList.add('selected');
                }
            }
        }

        function calculateResults() {
            const selected = document.querySelector('input[name="currentQuestion"]:checked');
            if (!selected) {
                alert('يرجى اختيار إجابة قبل إنهاء الاختبار');
                return;
            }

            saveCurrentAnswer();

            const scores = { visual: 0, auditory: 0, kinesthetic: 0 };
            let totalWeight = 0;

            studentAnswers.forEach((answerIndex, questionIndex) => {
                const question = questions[questionIndex];
                const selectedOption = question.options[answerIndex];
                scores[selectedOption.type] += selectedOption.weight;
                totalWeight += selectedOption.weight;
            });

            const percentages = {
                visual: Math.round((scores.visual / totalWeight) * 100),
                auditory: Math.round((scores.auditory / totalWeight) * 100),
                kinesthetic: Math.round((scores.kinesthetic / totalWeight) * 100)
            };

            const dominantStyle = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);

            const studentInfo = {
                id: Date.now(),
                name: document.getElementById('studentName').value.trim(),
                age: parseInt(document.getElementById('studentAge').value),
                grade: document.getElementById('studentGrade').value,
                learningStyle: dominantStyle,
                scores: scores,
                percentages: percentages,
                answers: [...studentAnswers],
                date: new Date().toLocaleDateString('ar-SA'),
                timestamp: new Date().toISOString()
            };

            studentData.push(studentInfo);
            localStorage.setItem('studentData', JSON.stringify(studentData));

            showResults(studentInfo);
        }

        function showResults(studentInfo) {
            document.getElementById('assessmentSection').classList.add('hidden');
            document.getElementById('resultsSection').classList.remove('hidden');

            const styleInfo = learningStyles[studentInfo.learningStyle];
            
            // Update main result card
            const resultCard = document.getElementById('mainResultCard');
            resultCard.className = `result-card ${studentInfo.learningStyle} mb-10`;
            
            document.getElementById('resultIcon').textContent = styleInfo.icon;
            document.getElementById('resultTitle').textContent = styleInfo.name;
            document.getElementById('resultDescription').textContent = styleInfo.description;
            document.getElementById('resultPercentage').textContent = studentInfo.percentages[studentInfo.learningStyle] + '%';

            // Update score circles
            document.getElementById('visualScore').textContent = studentInfo.percentages.visual + '%';
            document.getElementById('auditoryScore').textContent = studentInfo.percentages.auditory + '%';
            document.getElementById('kinestheticScore').textContent = studentInfo.percentages.kinesthetic + '%';

            // Generate personalized learning plan
            generatePersonalizedLearningPlan(studentInfo, styleInfo);

            // Generate personalized tips
            generatePersonalizedTips(styleInfo);

            // Scroll to results
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        function generatePersonalizedLearningPlan(studentInfo, styleInfo) {
            const planContainer = document.getElementById('learningPlan');
            
            const planContent = `
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="plan-card">
                        <h5 class="font-bold text-lg mb-3 text-gray-800">🎯 الأنشطة المقترحة لك:</h5>
                        <ul class="space-y-2">
                            ${styleInfo.activities.map(activity => `
                                <li class="flex items-start">
                                    <span class="text-blue-600 ml-2 mt-1">•</span>
                                    <span class="text-gray-700">${activity}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                    <div class="plan-card">
                        <h5 class="font-bold text-lg mb-3 text-gray-800">🛠️ الأدوات المساعدة:</h5>
                        <ul class="space-y-2">
                            ${styleInfo.studyMethods.map(method => `
                                <li class="flex items-start">
                                    <span class="text-green-600 ml-2 mt-1">•</span>
                                    <span class="text-gray-700">${method}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                </div>
                <div class="plan-card mt-6">
                    <h5 class="font-bold text-lg mb-3 text-gray-800">📊 طريقة التقييم المناسبة لك:</h5>
                    <p class="text-gray-700 leading-relaxed">${styleInfo.assessment}</p>
                </div>
                <div class="plan-card">
                    <h5 class="font-bold text-lg mb-3 text-gray-800">🎓 استراتيجيات التدريس المناسبة:</h5>
                    <ul class="space-y-2">
                        ${styleInfo.teachingStrategies.map(strategy => `
                            <li class="flex items-start">
                                <span class="text-purple-600 ml-2 mt-1">•</span>
                                <span class="text-gray-700">${strategy}</span>
                            </li>
                        `).join('')}
                    </ul>
                </div>
            `;
            
            planContainer.innerHTML = planContent;
        }

        function generatePersonalizedTips(styleInfo) {
            const tipsContainer = document.getElementById('personalizedTips');
            
            const tipsContent = styleInfo.tips.map(tip => `
                <div class="plan-card">
                    <div class="flex items-start">
                        <span class="text-yellow-500 text-2xl ml-3 mt-1">💡</span>
                        <div>
                            <p class="text-gray-700 leading-relaxed">${tip}</p>
                        </div>
                    </div>
                </div>
            `).join('');
            
            tipsContainer.innerHTML = tipsContent;
        }

        function downloadReport() {
            const lastStudent = studentData[studentData.length - 1];
            if (!lastStudent) return;

            const styleInfo = learningStyles[lastStudent.learningStyle];
            
            const reportContent = `
تقرير نمط التعلم الشخصي المفصل
================================

معلومات الطالب:
===============
الاسم: ${lastStudent.name}
العمر: ${lastStudent.age} سنة
الصف: ${lastStudent.grade}
تاريخ الاختبار: ${lastStudent.date}

نتائج الاختبار:
===============
نمط التعلم الرئيسي: ${styleInfo.name} ${styleInfo.icon}
الوصف: ${styleInfo.description}

النتائج التفصيلية:
==================
- المتعلم البصري: ${lastStudent.percentages.visual}%
- المتعلم السمعي: ${lastStudent.percentages.auditory}%
- المتعلم الحركي: ${lastStudent.percentages.kinesthetic}%

خصائص نمط التعلم:
==================
${styleInfo.characteristics.map(char => `• ${char}`).join('\n')}

النصائح المخصصة:
================
${styleInfo.tips.map(tip => `• ${tip}`).join('\n')}

الأنشطة المقترحة:
================
${styleInfo.activities.map(activity => `• ${activity}`).join('\n')}

طرق الدراسة المناسبة:
====================
${styleInfo.studyMethods.map(method => `• ${method}`).join('\n')}

استراتيجيات التدريس:
====================
${styleInfo.teachingStrategies.map(strategy => `• ${strategy}`).join('\n')}

طريقة التقييم المناسبة:
======================
${styleInfo.assessment}

توصيات للمعلمين:
=================
• تنويع طرق التدريس لتناسب نمط التعلم المحدد
• استخدام الأدوات والوسائل المناسبة لهذا النمط
• تطبيق استراتيجيات التقييم المناسبة
• توفير بيئة تعليمية محفزة لهذا النمط

---
تم إنشاء هذا التقرير بواسطة منصة أنماط التعلم الذكية
تاريخ الإنشاء: ${new Date().toLocaleDateString('ar-SA')}
            `;

            const blob = new Blob([reportContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `تقرير_نمط_التعلم_${lastStudent.name}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function shareResults() {
            const lastStudent = studentData[studentData.length - 1];
            if (!lastStudent) return;

            const styleInfo = learningStyles[lastStudent.learningStyle];
            const shareText = `🎓 اكتشفت نمط تعلمي في منصة أنماط التعلم الذكية!\n\n${styleInfo.name} ${styleInfo.icon}\n${styleInfo.description}\n\nالنتيجة: ${lastStudent.percentages[lastStudent.learningStyle]}%\n\nالنتائج التفصيلية:\n👁️ بصري: ${lastStudent.percentages.visual}%\n👂 سمعي: ${lastStudent.percentages.auditory}%\n✋ حركي: ${lastStudent.percentages.kinesthetic}%\n\n#أنماط_التعلم #التعليم_الذكي #التعلم_المخصص`;

            if (navigator.share) {
                navigator.share({
                    title: 'نتيجة اختبار نمط التعلم',
                    text: shareText
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('تم نسخ النتائج! يمكنك مشاركتها الآن');
                });
            }
        }

        function retakeTest() {
            if (confirm('هل تريد إعادة الاختبار؟ سيتم حذف النتائج الحالية.')) {
                showWelcomeSection();
                document.getElementById('studentName').value = '';
                document.getElementById('studentAge').value = '';
                document.getElementById('studentGrade').value = '';
            }
        }

        // Teacher Functions
        function showTeacherAccess() {
            if (!teacherData) {
                showTeacherSetup();
            } else {
                showTeacherLogin();
            }
        }

        function showTeacherSetup() {
            document.getElementById('teacherSetupModal').classList.remove('hidden');
            document.getElementById('teacherSetupModal').classList.add('flex');
            document.getElementById('teacherName').focus();
        }

        function hideTeacherSetup() {
            document.getElementById('teacherSetupModal').classList.add('hidden');
            document.getElementById('teacherSetupModal').classList.remove('flex');
            clearSetupForm();
        }

        function clearSetupForm() {
            document.getElementById('teacherName').value = '';
            document.getElementById('teacherSchool').value = '';
            document.getElementById('newTeacherPassword').value = '';
            document.getElementById('confirmTeacherPassword').value = '';
            document.getElementById('setupError').classList.add('hidden');
            resetPasswordStrength();
        }

        function checkPasswordStrength() {
            const password = document.getElementById('newTeacherPassword').value;
            const strengthBar = document.getElementById('strengthBar');
            const strengthText = document.getElementById('strengthText');
            
            let strength = 0;
            let text = 'ضعيف';
            let color = '#ef4444';

            if (password.length >= 8) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[a-z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;

            if (strength >= 4) {
                text = 'قوي جداً';
                color = '#10b981';
            } else if (strength >= 3) {
                text = 'جيد';
                color = '#f59e0b';
            } else if (strength >= 2) {
                text = 'متوسط';
                color = '#f97316';
            }

            strengthBar.style.width = `${(strength / 5) * 100}%`;
            strengthBar.style.backgroundColor = color;
            strengthText.textContent = text;
        }

        function resetPasswordStrength() {
            document.getElementById('strengthBar').style.width = '0%';
            document.getElementById('strengthText').textContent = 'ضعيف';
        }

        function setupTeacherAccount() {
            const name = document.getElementById('teacherName').value.trim();
            const school = document.getElementById('teacherSchool').value.trim();
            const password = document.getElementById('newTeacherPassword').value;
            const confirmPassword = document.getElementById('confirmTeacherPassword').value;
            const errorDiv = document.getElementById('setupError');

            if (!name || !password || !confirmPassword) {
                showError(errorDiv, 'يرجى إكمال جميع الحقول المطلوبة');
                return;
            }

            if (password.length < 8) {
                showError(errorDiv, 'يجب أن تكون كلمة المرور 8 أحرف على الأقل');
                return;
            }

            if (password !== confirmPassword) {
                showError(errorDiv, 'كلمات المرور غير متطابقة');
                return;
            }

            // Hash password (simple encoding for demo)
            const hashedPassword = btoa(password + 'salt_key_2024');
            
            teacherData = {
                name: name,
                school: school || 'غير محدد',
                password: hashedPassword,
                createdAt: new Date().toISOString(),
                lastLogin: null
            };

            localStorage.setItem('teacherData', JSON.stringify(teacherData));
            
            hideTeacherSetup();
            alert('تم إنشاء حساب المعلم بنجاح! يمكنك الآن تسجيل الدخول');
            showTeacherLogin();
        }

        function showTeacherLogin() {
            document.getElementById('teacherLoginModal').classList.remove('hidden');
            document.getElementById('teacherLoginModal').classList.add('flex');
            
            if (teacherData) {
                document.getElementById('welcomeTeacherText').textContent = `مرحباً ${teacherData.name}، أدخل كلمة المرور`;
            }
            
            document.getElementById('teacherPassword').focus();
        }

        function hideTeacherLogin() {
            document.getElementById('teacherLoginModal').classList.add('hidden');
            document.getElementById('teacherLoginModal').classList.remove('flex');
            document.getElementById('teacherPassword').value = '';
            document.getElementById('loginError').classList.add('hidden');
        }

        function verifyTeacher() {
            const password = document.getElementById('teacherPassword').value;
            const hashedPassword = btoa(password + 'salt_key_2024');
            
            if (teacherData && teacherData.password === hashedPassword) {
                isTeacherLoggedIn = true;
                teacherData.lastLogin = new Date().toISOString();
                localStorage.setItem('teacherData', JSON.stringify(teacherData));
                
                hideTeacherLogin();
                showTeacherDashboard();
            } else {
                document.getElementById('loginError').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('loginError').classList.add('hidden');
                }, 3000);
            }
        }

        function logout() {
            isTeacherLoggedIn = false;
            document.getElementById('teacherDashboard').classList.add('hidden');
            showWelcomeSection();
        }

        function showTeacherDashboard() {
            document.getElementById('welcomeSection').classList.add('hidden');
            document.getElementById('assessmentSection').classList.add('hidden');
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('teacherDashboard').classList.remove('hidden');
            
            document.getElementById('teacherWelcome').textContent = `مرحباً ${teacherData.name} - ${teacherData.school}`;
            
            updateTeacherStatistics();
            displayStudentsList();
            createCharts();
            populateFilters();
        }

        function updateTeacherStatistics() {
            const total = studentData.length;
            const visual = studentData.filter(s => s.learningStyle === 'visual').length;
            const auditory = studentData.filter(s => s.learningStyle === 'auditory').length;
            const kinesthetic = studentData.filter(s => s.learningStyle === 'kinesthetic').length;

            document.getElementById('totalStudents').textContent = total;
            document.getElementById('visualLearners').textContent = visual;
            document.getElementById('auditoryLearners').textContent = auditory;
            document.getElementById('kinestheticLearners').textContent = kinesthetic;
        }

        function createCharts() {
            createLearningStyleChart();
            createGradeDistributionChart();
        }

        function createLearningStyleChart() {
            const ctx = document.getElementById('learningStyleChart').getContext('2d');
            const visual = studentData.filter(s => s.learningStyle === 'visual').length;
            const auditory = studentData.filter(s => s.learningStyle === 'auditory').length;
            const kinesthetic = studentData.filter(s => s.learningStyle === 'kinesthetic').length;

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['بصري 👁️', 'سمعي 👂', 'حركي ✋'],
                    datasets: [{
                        data: [visual, auditory, kinesthetic],
                        backgroundColor: ['#3B82F6', '#10B981', '#8B5CF6'],
                        borderWidth: 3,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: {
                                    family: 'Cairo',
                                    size: 14
                                },
                                padding: 20
                            }
                        }
                    }
                }
            });
        }

        function createGradeDistributionChart() {
            const ctx = document.getElementById('gradeDistributionChart').getContext('2d');
            const gradeCount = {};
            
            studentData.forEach(student => {
                gradeCount[student.grade] = (gradeCount[student.grade] || 0) + 1;
            });

            const labels = Object.keys(gradeCount);
            const data = Object.values(gradeCount);

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'عدد الطلاب',
                        data: data,
                        backgroundColor: 'rgba(99, 102, 241, 0.8)',
                        borderColor: 'rgba(99, 102, 241, 1)',
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    family: 'Cairo'
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                font: {
                                    family: 'Cairo'
                                }
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    family: 'Cairo'
                                }
                            }
                        }
                    }
                }
            });
        }

        function populateFilters() {
            const gradeFilter = document.getElementById('filterGrade');
            const grades = [...new Set(studentData.map(s => s.grade))];
            
            gradeFilter.innerHTML = '<option value="">جميع الصفوف</option>';
            grades.forEach(grade => {
                gradeFilter.innerHTML += `<option value="${grade}">${grade}</option>`;
            });
        }

        function displayStudentsList() {
            const container = document.getElementById('studentsList');
            
            if (studentData.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">لا توجد بيانات طلاب حتى الآن</p>';
                return;
            }

            container.innerHTML = studentData.map(student => {
                const styleInfo = learningStyles[student.learningStyle];
                return `
                    <div class="dashboard-card hover-lift">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center mb-3">
                                    <h4 class="text-xl font-bold text-gray-800">${student.name}</h4>
                                    <span class="mr-3 text-3xl">${styleInfo.icon}</span>
                                    <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">
                                        ${styleInfo.name}
                                    </span>
                                </div>
                                <div class="grid md:grid-cols-2 gap-4 text-gray-600">
                                    <div>
                                        <p class="mb-1"><strong>العمر:</strong> ${student.age} سنة</p>
                                        <p class="mb-1"><strong>الصف:</strong> ${student.grade}</p>
                                        <p><strong>التاريخ:</strong> ${student.date}</p>
                                    </div>
                                    <div>
                                        <p class="mb-1"><strong>النسبة الرئيسية:</strong> <span class="text-blue-600 font-semibold">${student.percentages[student.learningStyle]}%</span></p>
                                        <div class="text-sm">
                                            <div class="flex justify-between">
                                                <span>👁️ بصري:</span>
                                                <span class="font-medium">${student.percentages.visual}%</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span>👂 سمعي:</span>
                                                <span class="font-medium">${student.percentages.auditory}%</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span>✋ حركي:</span>
                                                <span class="font-medium">${student.percentages.kinesthetic}%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="text-center">
                                <button class="btn-primary text-sm py-2 px-4 hover-lift" onclick="generateIndividualPlan('${student.id}')">
                                    📋 خطة فردية
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterStudents() {
            const gradeFilter = document.getElementById('filterGrade').value;
            const styleFilter = document.getElementById('filterStyle').value;
            
            let filteredData = studentData;
            
            if (gradeFilter) {
                filteredData = filteredData.filter(s => s.grade === gradeFilter);
            }
            
            if (styleFilter) {
                filteredData = filteredData.filter(s => s.learningStyle === styleFilter);
            }
            
            const container = document.getElementById('studentsList');
            
            if (filteredData.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">لا توجد نتائج مطابقة للفلتر المحدد</p>';
                return;
            }

            container.innerHTML = filteredData.map(student => {
                const styleInfo = learningStyles[student.learningStyle];
                return `
                    <div class="dashboard-card hover-lift">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center mb-3">
                                    <h4 class="text-xl font-bold text-gray-800">${student.name}</h4>
                                    <span class="mr-3 text-3xl">${styleInfo.icon}</span>
                                    <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">
                                        ${styleInfo.name}
                                    </span>
                                </div>
                                <div class="grid md:grid-cols-2 gap-4 text-gray-600">
                                    <div>
                                        <p class="mb-1"><strong>العمر:</strong> ${student.age} سنة</p>
                                        <p class="mb-1"><strong>الصف:</strong> ${student.grade}</p>
                                        <p><strong>التاريخ:</strong> ${student.date}</p>
                                    </div>
                                    <div>
                                        <p class="mb-1"><strong>النسبة الرئيسية:</strong> <span class="text-blue-600 font-semibold">${student.percentages[student.learningStyle]}%</span></p>
                                        <div class="text-sm">
                                            <div class="flex justify-between">
                                                <span>👁️ بصري:</span>
                                                <span class="font-medium">${student.percentages.visual}%</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span>👂 سمعي:</span>
                                                <span class="font-medium">${student.percentages.auditory}%</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span>✋ حركي:</span>
                                                <span class="font-medium">${student.percentages.kinesthetic}%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="text-center">
                                <button class="btn-primary text-sm py-2 px-4 hover-lift" onclick="generateIndividualPlan('${student.id}')">
                                    📋 خطة فردية
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Learning Plan Generators
        function generateVisualPlan() {
            const styleInfo = learningStyles.visual;
            const visualStudents = studentData.filter(s => s.learningStyle === 'visual');
            
            showLearningPlanModal('خطة تعليمية للمتعلمين البصريين', styleInfo, visualStudents);
        }

        function generateAuditoryPlan() {
            const styleInfo = learningStyles.auditory;
            const auditoryStudents = studentData.filter(s => s.learningStyle === 'auditory');
            
            showLearningPlanModal('خطة تعليمية للمتعلمين السمعيين', styleInfo, auditoryStudents);
        }

        function generateKinestheticPlan() {
            const styleInfo = learningStyles.kinesthetic;
            const kinestheticStudents = studentData.filter(s => s.learningStyle === 'kinesthetic');
            
            showLearningPlanModal('خطة تعليمية للمتعلمين الحركيين', styleInfo, kinestheticStudents);
        }

        function generateIndividualPlan(studentId) {
            const student = studentData.find(s => s.id == studentId);
            if (!student) return;
            
            const styleInfo = learningStyles[student.learningStyle];
            showLearningPlanModal(`خطة تعليمية فردية - ${student.name}`, styleInfo, [student], true);
        }

        function showLearningPlanModal(title, styleInfo, students, isIndividual = false) {
            document.getElementById('planModalTitle').textContent = title;
            
            const planContent = `
                <div class="space-y-6">
                    ${isIndividual ? `
                        <div class="dashboard-card">
                            <h4 class="text-lg font-bold text-gray-800 mb-3">👤 معلومات الطالب</h4>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <p><strong>الاسم:</strong> ${students[0].name}</p>
                                    <p><strong>العمر:</strong> ${students[0].age} سنة</p>
                                    <p><strong>الصف:</strong> ${students[0].grade}</p>
                                </div>
                                <div>
                                    <p><strong>نمط التعلم:</strong> ${styleInfo.name}</p>
                                    <p><strong>النسبة:</strong> ${students[0].percentages[students[0].learningStyle]}%</p>
                                    <p><strong>تاريخ الاختبار:</strong> ${students[0].date}</p>
                                </div>
                            </div>
                        </div>
                    ` : `
                        <div class="dashboard-card">
                            <h4 class="text-lg font-bold text-gray-800 mb-3">📊 إحصائيات المجموعة</h4>
                            <p><strong>عدد الطلاب:</strong> ${students.length} طالب</p>
                            <p><strong>نمط التعلم:</strong> ${styleInfo.name} ${styleInfo.icon}</p>
                        </div>
                    `}
                    
                    <div class="dashboard-card">
                        <h4 class="text-lg font-bold text-gray-800 mb-4">📝 وصف نمط التعلم</h4>
                        <p class="text-gray-700 leading-relaxed">${styleInfo.description}</p>
                    </div>
                    
                    <div class="dashboard-card">
                        <h4 class="text-lg font-bold text-gray-800 mb-4">🎯 الخصائص الرئيسية</h4>
                        <ul class="space-y-2">
                            ${styleInfo.characteristics.map(char => `
                                <li class="flex items-start">
                                    <span class="text-blue-600 ml-2 mt-1">•</span>
                                    <span class="text-gray-700">${char}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="dashboard-card">
                            <h4 class="text-lg font-bold text-gray-800 mb-4">🎨 الأنشطة التعليمية</h4>
                            <ul class="space-y-2">
                                ${styleInfo.activities.map(activity => `
                                    <li class="flex items-start">
                                        <span class="text-green-600 ml-2 mt-1">•</span>
                                        <span class="text-gray-700">${activity}</span>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                        
                        <div class="dashboard-card">
                            <h4 class="text-lg font-bold text-gray-800 mb-4">🛠️ طرق الدراسة</h4>
                            <ul class="space-y-2">
                                ${styleInfo.studyMethods.map(method => `
                                    <li class="flex items-start">
                                        <span class="text-purple-600 ml-2 mt-1">•</span>
                                        <span class="text-gray-700">${method}</span>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <h4 class="text-lg font-bold text-gray-800 mb-4">🎓 استراتيجيات التدريس</h4>
                        <ul class="space-y-2">
                            ${styleInfo.teachingStrategies.map(strategy => `
                                <li class="flex items-start">
                                    <span class="text-orange-600 ml-2 mt-1">•</span>
                                    <span class="text-gray-700">${strategy}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                    
                    <div class="dashboard-card">
                        <h4 class="text-lg font-bold text-gray-800 mb-4">📊 طرق التقييم المناسبة</h4>
                        <p class="text-gray-700 leading-relaxed">${styleInfo.assessment}</p>
                    </div>
                    
                    <div class="dashboard-card">
                        <h4 class="text-lg font-bold text-gray-800 mb-4">💡 نصائح للطلاب</h4>
                        <ul class="space-y-2">
                            ${styleInfo.tips.map(tip => `
                                <li class="flex items-start">
                                    <span class="text-yellow-600 ml-2 mt-1">•</span>
                                    <span class="text-gray-700">${tip}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                </div>
            `;
            
            document.getElementById('planModalContent').innerHTML = planContent;
            
            // Store current plan for download
            currentGeneratedPlan = {
                title: title,
                styleInfo: styleInfo,
                students: students,
                isIndividual: isIndividual
            };
            
            document.getElementById('learningPlanModal').classList.remove('hidden');
            document.getElementById('learningPlanModal').classList.add('flex');
        }

        function hideLearningPlanModal() {
            document.getElementById('learningPlanModal').classList.add('hidden');
            document.getElementById('learningPlanModal').classList.remove('flex');
        }

        function downloadCurrentPlan() {
            if (!currentGeneratedPlan) return;
            
            const { title, styleInfo, students, isIndividual } = currentGeneratedPlan;
            
            let planContent = `
${title}
${'='.repeat(title.length)}

`;

            if (isIndividual) {
                const student = students[0];
                planContent += `
معلومات الطالب:
===============
الاسم: ${student.name}
العمر: ${student.age} سنة
الصف: ${student.grade
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97d6692186a3b157',t:'MTc1NzU4NTc5Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>